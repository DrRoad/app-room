# global constants available to the app
# last update:2016-10-08

# constants required for every app
appName <- 'room'
appTitle <- 'Raumklima'
app_id <- 'eu.ownyourdata.room'
scheduler_id <- 'eu.ownyourdata.scheduler'        

# definition of data structure
currRepoSelect <- ''
appRepos <- list()
appReposDefault <- list(Nagios   = 'eu.ownyourdata.room.nagios',
                        Actuator = 'eu.ownyourdata.room.actuator',
                        Verlauf  = 'eu.ownyourdata.room.log')
appStruct <- list(
        Nagios = list(
                fields      = c('name', 'nagiosUrl', 'repo', 'user', 'password', 'active'),
                fieldKey    = 'name',
                fieldTypes  = c('string', 'string', 'string', 'string', 'string', 'boolean'),
                fieldInits  = c('empty', 'empty', 'empty', 'empty', 'empty', 'false'),
                fieldTitles = c('Sensor', 'NAGIOS URL', 'Repo', 'Benutzer', 'Passwort', 'aktiv'),
                fieldWidths = c(150, 200, 150, 100, 100, 60)),
        Actuator = list(
                fields      = c('name', 'scenarios', 'params', 'command', 'active'),
                fieldKey    = 'name',
                fieldTypes  = c('string', 'string', 'string', 'string', 'boolean'),
                fieldInits  = c('empty', 'empty', 'empty', 'empty', 'false'),
                fieldTitles = c('Aktor', 'Szenario', 'Parameter', 'Befehl', 'aktiv'),
                fieldWidths = c(150, 150, 250, 100, 60)),
        Verlauf = list(
                fields      = c('date', 'description'),
                fieldKey    = 'date',
                fieldTypes  = c('date', 'string'),
                fieldInits  = c('empty', 'empty'),
                fieldTitles = c('Datum', 'Text'),
                fieldWidths = c(150, 450)))

# appFields <- c('timestamp', 'value')
# appFieldKey <- 'timestamp'
# appFieldTypes <- c('timestamp', 'number')
# appFieldInits <- c('empty', 'empty')
# appFieldTitles <- c('Zeit', 'Wert')
# appFieldWidths <- c(100, 100)

# Version information
currVersion <- "0.3.1"
verHistory <- data.frame(rbind(
        c(version = "0.3.1",
          text    = "Verwendung von Listennamen in neuem Datentresor"),
        c(version = "0.3.0",
          text    = "erstes Release")
))

# app specific constants
sensorUiList <- vector()
actuatorUiList <- c('Dienstagabend')

scriptRepo <- 'eu.ownyourdata.room.script'
nagiosImportScript <- 'ZGVmYXVsdEhlYWRlcnMgPC0gZnVuY3Rpb24odG9rZW4pIHsNCiAgICAgICAgYygnQWNjZXB0JyAgICAgICAgPSAnKi8qJywNCiAgICAgICAgICAnQ29udGVudC1UeXBlJyAgPSAnYXBwbGljYXRpb24vanNvbicsDQogICAgICAgICAgJ0F1dGhvcml6YXRpb24nID0gcGFzdGUoJ0JlYXJlcicsIHRva2VuKSkNCn0NCg0KaXRlbXNVcmwgPC0gZnVuY3Rpb24odXJsLCByZXBvX25hbWUpIHsNCiAgICAgICAgcGFzdGUwKHVybCwgJy9hcGkvcmVwb3MvJywgcmVwb19uYW1lLCAnL2l0ZW1zJykNCn0NCg0KZ2V0VG9rZW4gPC0gZnVuY3Rpb24ocGlhX3VybCwgYXBwX2tleSwgYXBwX3NlY3JldCkgew0KICAgICAgICBhdXRoX3VybCA8LSBwYXN0ZTAocGlhX3VybCwgJy9vYXV0aC90b2tlbicpDQogICAgICAgIG9wdFRpbWVvdXQgPC0gUkN1cmw6OmN1cmxPcHRpb25zKGNvbm5lY3R0aW1lb3V0ID0gMTApDQogICAgICAgIHJlc3BvbnNlIDwtIHRyeUNhdGNoKA0KICAgICAgICAgICAgICAgIFJDdXJsOjpwb3N0Rm9ybShhdXRoX3VybCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpZW50X2lkICAgICA9IGFwcF9rZXksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsaWVudF9zZWNyZXQgPSBhcHBfc2VjcmV0LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmFudF90eXBlICAgID0gJ2NsaWVudF9jcmVkZW50aWFscycsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5vcHRzICAgICAgICAgPSBvcHRUaW1lb3V0KSwNCiAgICAgICAgICAgICAgICBlcnJvciA9IGZ1bmN0aW9uKGUpIHsgcmV0dXJuKE5BKSB9KQ0KICAgICAgICBpZiAoaXMubmEocmVzcG9uc2UpKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuKE5BKQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGlmKGpzb25saXRlOjp2YWxpZGF0ZShyZXNwb25zZVsxXSkpew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuKHJqc29uOjpmcm9tSlNPTihyZXNwb25zZVsxXSkkYWNjZXNzX3Rva2VuKQ0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4oTkEpDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICB9DQp9DQoNCnNldHVwQXBwIDwtIGZ1bmN0aW9uKHBpYV91cmwsIGFwcF9rZXksIGFwcF9zZWNyZXQpIHsNCiAgICAgICAgYXBwX3Rva2VuIDwtIGdldFRva2VuKHBpYV91cmwsIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwX2tleSwgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBfc2VjcmV0KQ0KICAgICAgICBpZihpcy5uYShhcHBfdG9rZW4pKXsNCiAgICAgICAgICAgICAgICB2ZWN0b3IoKQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGMoJ3VybCcgICAgICAgID0gcGlhX3VybCwNCiAgICAgICAgICAgICAgICAgICdhcHBfa2V5JyAgICA9IGFwcF9rZXksDQogICAgICAgICAgICAgICAgICAnYXBwX3NlY3JldCcgPSBhcHBfc2VjcmV0LA0KICAgICAgICAgICAgICAgICAgJ3Rva2VuJyAgICAgID0gYXBwX3Rva2VuKQ0KICAgICAgICB9DQp9DQoNCnIyZCA8LSBmdW5jdGlvbihyZXNwb25zZSl7DQogICAgICAgIGlmIChpcy5uYShyZXNwb25zZSkpIHsNCiAgICAgICAgICAgICAgICBkYXRhLmZyYW1lKCkNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBpZiAobmNoYXIocmVzcG9uc2UpID4gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsIDwtIHJqc29uOjpmcm9tSlNPTihyZXNwb25zZSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGxlbmd0aChyZXRWYWwpID09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5mcmFtZSgpDQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJ2Vycm9yJyAlaW4lIG5hbWVzKHJldFZhbCkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmZyYW1lKCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzLm51bGwocmV0VmFsJG1lc3NhZ2UpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmV0VmFsJG1lc3NhZ2UgPT0gDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Vycm9yLmFjY2Vzc0RlbmllZCcpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5mcmFtZSgpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkby5jYWxsKHJiaW5kLCANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXBwbHkocmV0VmFsLCANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5mcmFtZSkpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvLmNhbGwocmJpbmQsIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXBwbHkocmV0VmFsLCANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuZnJhbWUpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmZyYW1lKCkNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIH0NCn0NCg0KcmVhZEl0ZW1zIDwtIGZ1bmN0aW9uKGFwcCwgcmVwb191cmwpIHsNCiAgICAgICAgaWYgKGxlbmd0aChhcHApID09IDApIHsNCiAgICAgICAgICAgICAgICBkYXRhLmZyYW1lKCkNCiAgICAgICAgICAgICAgICByZXR1cm4oKQ0KICAgICAgICB9DQogICAgICAgIGhlYWRlcnMgPC0gZGVmYXVsdEhlYWRlcnMoYXBwW1sndG9rZW4nXV0pDQogICAgICAgIHVybF9kYXRhIDwtIHBhc3RlMChyZXBvX3VybCwgJz9zaXplPTIwMDAnKQ0KICAgICAgICBoZWFkZXIgPC0gUkN1cmw6OmJhc2ljSGVhZGVyR2F0aGVyZXIoKQ0KICAgICAgICBkb2MgPC0gdHJ5Q2F0Y2goDQogICAgICAgICAgICAgICAgUkN1cmw6OmdldFVSSSh1cmxfZGF0YSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5vcHRzPWxpc3QoaHR0cGhlYWRlciA9IGhlYWRlcnMpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyZnVuY3Rpb24gPSBoZWFkZXIkdXBkYXRlKSwNCiAgICAgICAgICAgICAgICBlcnJvciA9IGZ1bmN0aW9uKGUpIHsgcmV0dXJuKE5BKSB9KQ0KICAgICAgICByZXNwb25zZSA8LSBOQQ0KICAgICAgICByZXNwRGF0YSA8LSBkYXRhLmZyYW1lKCkNCiAgICAgICAgaWYoIWlzLm5hKGRvYykpew0KICAgICAgICAgICAgICAgIHJlY3MgPC0gdHJ5Q2F0Y2goDQogICAgICAgICAgICAgICAgICAgICAgICBhcy5pbnRlZ2VyKGhlYWRlciR2YWx1ZSgpW1snWC1Ub3RhbC1Db3VudCddXSksDQogICAgICAgICAgICAgICAgICAgICAgICBlcnJvciA9IGZ1bmN0aW9uKGUpIHsgcmV0dXJuKDApfSkNCiAgICAgICAgICAgICAgICBpZihyZWNzID4gMjAwMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgZm9yKHBhZ2UgaW4gMDpmbG9vcihyZWNzLzIwMDApKXsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsX2RhdGEgPC0gcGFzdGUwKHJlcG9fdXJsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJz9wYWdlPScsIHBhZ2UsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnJnNpemU9MjAwMCcpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlIDwtIHRyeUNhdGNoKA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJDdXJsOjpnZXRVUkwodXJsX2RhdGEsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAub3B0cz1saXN0KGh0dHBoZWFkZXI9aGVhZGVycykpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yID0gZnVuY3Rpb24oZSkgeyByZXR1cm4oTkEpIH0pDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1YkRhdGEgPC0gcjJkKHJlc3BvbnNlKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihucm93KHJlc3BEYXRhKT4wKXsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwRGF0YSA8LSByYmluZChyZXNwRGF0YSwgc3ViRGF0YSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwRGF0YSA8LSBzdWJEYXRhDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPC0gdHJ5Q2F0Y2goDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJDdXJsOjpnZXRVUkwodXJsX2RhdGEsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLm9wdHM9bGlzdChodHRwaGVhZGVyID0gaGVhZGVycykpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvciA9IGZ1bmN0aW9uKGUpIHsgcmV0dXJuKE5BKSB9KQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmVzcERhdGEgPC0gcjJkKHJlc3BvbnNlKQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXNwRGF0YQ0KfQ0KDQp3cml0ZUl0ZW0gPC0gZnVuY3Rpb24oYXBwLCByZXBvX3VybCwgaXRlbSkgew0KICAgICAgICBoZWFkZXJzIDwtIGRlZmF1bHRIZWFkZXJzKGFwcFtbJ3Rva2VuJ11dKQ0KICAgICAgICBkYXRhIDwtIHJqc29uOjp0b0pTT04oaXRlbSkNCiAgICAgICAgcmVzcG9uc2UgPC0gdHJ5Q2F0Y2goDQogICAgICAgICAgICAgICAgUkN1cmw6OnBvc3RGb3JtKHJlcG9fdXJsLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAub3B0cz1saXN0KGh0dHBoZWFkZXIgPSBoZWFkZXJzLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3RmaWVsZHMgPSBkYXRhKSksDQogICAgICAgICAgICAgICAgZXJyb3IgPSBmdW5jdGlvbihlKSB7IA0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuKE5BKSB9KQ0KICAgICAgICByZXNwb25zZQ0KfQ0KDQp1cGRhdGVJdGVtIDwtIGZ1bmN0aW9uKGFwcCwgcmVwb191cmwsIGl0ZW0sIGlkKSB7DQogICAgICAgIGhlYWRlcnMgPC0gZGVmYXVsdEhlYWRlcnMoYXBwW1sndG9rZW4nXV0pDQogICAgICAgIGl0ZW0gPC0gYyhpdGVtLCBjKGlkPWFzLm51bWVyaWMoaWQpKSkNCiAgICAgICAgZGF0YSA8LSByanNvbjo6dG9KU09OKGl0ZW0pDQogICAgICAgIHJlc3BvbnNlIDwtIHRyeUNhdGNoKA0KICAgICAgICAgICAgICAgIFJDdXJsOjpwb3N0Rm9ybShyZXBvX3VybCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLm9wdHM9bGlzdChodHRwaGVhZGVyID0gaGVhZGVycywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3N0ZmllbGRzID0gZGF0YSkpLA0KICAgICAgICAgICAgICAgIGVycm9yID0gZnVuY3Rpb24oZSkgeyByZXR1cm4oTkEpIH0pDQogICAgICAgIHJlc3BvbnNlDQp9DQoNCmRlbGV0ZUl0ZW0gPC0gZnVuY3Rpb24oYXBwLCByZXBvX3VybCwgaWQpew0KICAgICAgICBoZWFkZXJzIDwtIGRlZmF1bHRIZWFkZXJzKGFwcFtbJ3Rva2VuJ11dKQ0KICAgICAgICBpdGVtX3VybCA8LSBwYXN0ZTAocmVwb191cmwsICcvJywgaWQpDQogICAgICAgIHJlc3BvbnNlIDwtIHRyeUNhdGNoKA0KICAgICAgICAgICAgICAgIGh0dHI6OkRFTEVURShpdGVtX3VybCwgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZF9oZWFkZXJzKGhlYWRlcnMpKSwNCiAgICAgICAgICAgICAgICBlcnJvciA9IGZ1bmN0aW9uKGUpIHsgcmV0dXJuKE5BKSB9KQ0KICAgICAgICByZXNwb25zZQ0KfQ0KDQppbXBvcnROYWdpb3MgPC0gZnVuY3Rpb24obmFnaW9zVXJsLCBuYWdpb3NVc2VyLCBuYWdpb3NQd2QsIGFwcCwgcmVwbyl7DQogICAgICAgIGNudCA8LSAwDQogICAgICAgICMgZ2V0IGRhdGEgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgaGRsICA8LSBHRVQobmFnaW9zVXJsLCBhdXRoZW50aWNhdGUobmFnaW9zVXNlciwgbmFnaW9zUHdkKSkNCiAgICAgICAgaWYodmFsaWRhdGUoY29udGVudChoZGwsICJ0ZXh0IikpKSB7DQogICAgICAgICAgICAgICAgcmF3ICA8LSBqc29ubGl0ZTo6ZnJvbUpTT04oY29udGVudChoZGwsICJ0ZXh0IikpDQogICAgICAgICAgICAgICAgdG1wIDwtIHVubGlzdChyYXckZGF0YSRyb3cpDQogICAgICAgICAgICAgICAgdmFsIDwtIGFzLm51bWVyaWModG1wW3NlcSgzLCBsZW5ndGgodG1wKSwgMyldKQ0KICAgICAgICAgICAgICAgIG1ldGEgPC0gcmF3WzFdJG1ldGENCiAgICAgICAgICAgICAgICBzZXEgPC0gYXMuaW50ZWdlcihtZXRhJHN0YXJ0KSArIA0KICAgICAgICAgICAgICAgICAgICAgICAgKDE6YXMuaW50ZWdlcihtZXRhJHJvd3MpKSphcy5pbnRlZ2VyKG1ldGEkc3RlcCkNCiAgICAgICAgICAgICAgICBkYXRhIDwtIGFzLmRhdGEuZnJhbWUoY2JpbmQoc2VxLCB2YWwpKQ0KICAgICAgICAgICAgICAgICMgY29ubmVjdCBQSUEgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgICAgICAgICAgZGF0YV91cmwgPC0gaXRlbXNVcmwoYXBwW1sndXJsJ11dLCByZXBvKQ0KICAgICAgICAgICAgICAgIHBpYV9kYXRhIDwtIHJlYWRJdGVtcyhhcHAsIGRhdGFfdXJsKQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICMgbWVyZ2UgZGF0YQ0KICAgICAgICAgICAgICAgIGlmKG5yb3coZGF0YSkgPiAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZihucm93KHBpYV9kYXRhKSA+IDApew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtcmdfZGF0YSA8LSBtZXJnZShkYXRhLCBwaWFfZGF0YSwgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ5Lng9J3NlcScsIGJ5Lnk9J3RpbWVzdGFtcCcsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsbCA9IFRSVUUpDQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtcmdfZGF0YSA8LSBkYXRhDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1yZ19kYXRhJHZhbHVlIDwtIE5BDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1yZ19kYXRhJGlkIDwtIE5BDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKG5yb3cocGlhX2RhdGEpID4gMCl7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1yZ19kYXRhIDwtIHBpYV9kYXRhDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1yZ19kYXRhJHZhbCA8LSBOQQ0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXJnX2RhdGEgPC0gZGF0YS5mcmFtZSgpDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICMgd2hhdCBpcyBkaWZmZXJlbnQgLT4gdXBkYXRlSXRlbQ0KICAgICAgICAgICAgICAgIHVwZF9pdGVtcyA8LSBtcmdfZGF0YVsobXJnX2RhdGEkdmFsICE9IG1yZ19kYXRhJHZhbHVlKSAmIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICFpcy5uYShtcmdfZGF0YSRpZCksIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjKCdpZCcsICdzZXEnLCAndmFsJyldDQogICAgICAgICAgICAgICAgdXBkX2l0ZW1zIDwtIHVwZF9pdGVtc1tjb21wbGV0ZS5jYXNlcyh1cGRfaXRlbXMpLCBdDQogICAgICAgICAgICAgICAgaWYgKG5yb3codXBkX2l0ZW1zKSA+IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGludmlzaWJsZShhcHBseSgNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBkX2l0ZW1zLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbih4KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY250IDwtIGNudCArIDENCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtIDwtIGxpc3QodGltZXN0YW1wID0geFtbJ3NlcSddXSwgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlICAgICA9IHhbWyd2YWwnXV0pDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHVtbXkgPC0gdXBkYXRlSXRlbShhcHAsIGRhdGFfdXJsLCBpdGVtLCB4W1snaWQnXV0pDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICkpDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICMgd2hhdCBpcyBuZXcgLT4gd3JpdGVJdGVtDQogICAgICAgICAgICAgICAgbmV3X2l0ZW1zIDwtIG1yZ19kYXRhWyghaXMubmEobXJnX2RhdGEkdmFsKSAmIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpcy5uYShtcmdfZGF0YSR2YWx1ZSkpLCANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYygnc2VxJywgJ3ZhbCcpXQ0KICAgICAgICAgICAgICAgIGlmIChucm93KG5ld19pdGVtcykgPiAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpbnZpc2libGUoYXBwbHkoDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld19pdGVtcywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oeCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNudCA8PC0gY250ICsgMQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0gPC0gbGlzdCh0aW1lc3RhbXAgPSB4W1snc2VxJ11dLCANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgICAgID0geFtbJ3ZhbCddXSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkdW1teSA8LSB3cml0ZUl0ZW0oYXBwLCBkYXRhX3VybCwgaXRlbSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgKSkNCiAgICAgICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgY250DQp9DQoNCnBpYV91cmwgPC0gJ1twaWFfdXJsXScNCmFwcF9rZXkgPC0gJ1thcHBfa2V5XScNCmFwcF9zZWNyZXQgPC0gJ1thcHBfc2VjcmV0XScNCmFwcCA8LSBzZXR1cEFwcChwaWFfdXJsLCBhcHBfa2V5LCBhcHBfc2VjcmV0KQ0KdXJsIDwtIGl0ZW1zVXJsKHBpYV91cmwsICdldS5vd255b3VyZGF0YS5yb29tLm5hZ2lvcycpDQpzZW5zb3JzIDwtIHJlYWRJdGVtcyhhcHAsIHVybCkNCmZvciAoaSBpbiAxOm5yb3coc2Vuc29ycykpew0KICAgICAgICBpbXBvcnROYWdpb3MoDQogICAgICAgICAgICAgICAgYXMuY2hhcmFjdGVyKHNlbnNvcnNbaSwgJ25hZ2lvc1VybCddKSwNCiAgICAgICAgICAgICAgICBhcy5jaGFyYWN0ZXIoc2Vuc29yc1tpLCAndXNlciddKSwNCiAgICAgICAgICAgICAgICBhcy5jaGFyYWN0ZXIoc2Vuc29yc1tpLCAncGFzc3dvcmQnXSksDQogICAgICAgICAgICAgICAgYXBwLA0KICAgICAgICAgICAgICAgIGFzLmNoYXJhY3RlcihzZW5zb3JzW2ksICdyZXBvJ10pDQogICAgICAgICkNCn0NCg=='
